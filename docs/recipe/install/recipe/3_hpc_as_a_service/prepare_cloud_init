
#!/bin/bash
# # FILE: prepare_cloud_init
chpcInitPath=/opt/ohpc/admin/cloud_hpc_init
# if directory exists then mv to Old directory. TBD
mkdir -p $chpcInitPath
#copy Cloud HPC files to temp working directory
sudo cp -fr -L < ${SCRIPTDIR} >/ cloud_hpc_init/${chpc_base}/* $chpcInitPath/
export chpcInit=$chpcInitPath/chpc_init
export chpcSMSInit=$chpcInitPath/chpc_sms_init
sudo sed -i -e "s/<sms_ip>/${sms_ip}/g" $chpcInit
sudo sed -i -e "s/<update_cnodename_prefix>/${cnodename_prefix}/g" $chpcSMSInit
sudo sed -i -e "s/<update_num_ccomputes>/${num_ccomputes}/g" $chpcSMSInit
# Update hostname of HPC head node & NTP server information
sudo sed -i -e "s/<update_ntp_server>/${controller_ip}/g" $chpcSMSInit
sudo sed -i -e "s/<update_sms_name>/${sms_name}/g" $chpcSMSInit
if [[ ${enable_mrsh} -eq 1 ]];then
   # update mrsh for sms node
   cat $CHPC_SCRIPTDIR/sms/update_mrsh >> $chpcSMSInit
fi
if [[ ${enable_clustershell} -eq 1 ]];then
   # update clustershell for sms node
   cat $CHPC_SCRIPTDIR/sms/update_clustershell >> $chpcSMSInit
fi
# #   
