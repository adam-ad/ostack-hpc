diskimage-builder or dib uses environment variables and elements to customize the images. For debugging purpose, we will create default user chpc with a password intel8086, with sudo privilege. These variables are used by element devuser. 

% begin_ohpc_run
% ohpc_validation_newline
% ohpc_validation_comment # SECTION BMNOS
% ohpc_validation_comment # diskimage-builder initial config
% ohpc_validation_comment
\begin{lstlisting}[language=bash,keywords={}]
[ctrlr](*\#*) export DIB_DEV_USER_USERNAME=chpc
[ctrlr](*\#*) export DIB_DEV_USER_PASSWORD=intel8086
[ctrlr](*\#*) export DIB_DEV_USER_PWDLESS_SUDO=1
\end{lstlisting}
% end_phpc_run

Now add path to custom elements which are not part of base diskimage-builder. OpenHPC provides few HPC elements. [Note: This also can be part of openHPC provided rpm for dib. In that case remove this step]

% begin_ohpc_run
% ohpc_validation_newline
% ohpc_validation_comment # SECTION BMNOS
% ohpc_validation_comment # Add custom elements in DIB
% ohpc_validation_comment
\begin{lstlisting}[language=bash,keywords={}]
[ctrlr](*\#*) export ELEMENTS_PATH="$(realpath ../../dib/hpc/elements)"
\end{lstlisting}

Add path to HPC specific files [note: same as earlier, this too can be part of rpm package]

% begin_ohpc_run
% ohpc_validation_newline
% ohpc_validation_comment # SECTION BMNOS
% ohpc_validation_comment # Add path to HPC specific files
% ohpc_validation_comment
\begin{lstlisting}[language=bash,keywords={}]
[ctrlr](*\#*) export DIB_HPC_FILE_PATH="$(realpath ../../dib/hpc/hpc-files/)"
\end{lstlisting}

HPC elements are common for OpenHPC and Intel HPC Orchestrator, environment variable "DIB\_HPC\_BASE" tell dib which one to pick. For OpenHPC set environment variable

% begin_ohpc_run
% ohpc_validation_newline
% ohpc_validation_comment # SECTION BMNOS
% ohpc_validation_comment # Set DIB Element
% ohpc_validation_comment
\begin{lstlisting}[language=bash,keywords={}]
[ctrlr](*\#*) export DIB_ HPC_BASE="ohpc"
\end{lstlisting}
% end_ohpc_run

Make sure open hpc packages is installed. ohpc\_pkg is one of the input setup earlier in this document.

% begin_ohpc_run
% ohpc_validation_newline
% ohpc_validation_comment # SECTION BMNOS
% ohpc_validation_comment # Check package installed
% ohpc_validation_comment
\begin{lstlisting}[language=bash,keywords={}]
[ctrlr](*\#*) yum -y install ${ohpc_pkg}
\end{lstlisting}
% end_ohpc_run

Export same to DIB.

% begin_ohpc_run
% ohpc_validation_newline
% ohpc_validation_comment # SECTION BMNOS
% ohpc_validation_comment # Export to DIB
% ohpc_validation_comment
\begin{lstlisting}[language=bash,keywords={}]
[ctrlr](*\#*) export DIB_HPC_OHPC_PKG=${ohpc_pkg}
\end{lstlisting}
% end_ohpc_run

Create list of HPC elements needed to build HPC images, by starting hpc-env-base. This element will setup basic hpc environment to build hpc images.

% begin_ohpc_run
% ohpc_validation_newline
% ohpc_validation_comment # SECTION BMNOS
% ohpc_validation_comment # Create listof elements
% ohpc_validation_comment
\begin{lstlisting}[language=bash,keywords={}]
[ctrlr](*\#*) DIB_HPC_ELEMENTS="hpc-env-base"
\end{lstlisting}
% end_ohpc_run